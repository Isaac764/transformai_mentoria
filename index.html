<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Transformai Mentoria</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>

  <!-- HERO MOBILE -->
  <section class="hero-mobile">
    <button class="scroll-btn">
      Inscreva-se abaixo ↓
    </button>
  </section>

  <!-- FORM SECTION -->
  <section class="form-section">
    <div class="hero-content">

      <span class="badge">
        16 de Maio | 07:30h | Praia Mar Hotel - São Luís MA
      </span>

      <h1>O maior evento para empresários e empreendedores</h1>
      <h2 class="highlight">TRANSFORMAI</h2>

      <p class="desc">
        O TRANSFORMAI é uma imersão para empresários e empreendedores cristãos que compreenderam que 
        prosperar não é apenas crescer, mas administrar com visão, decidir com sabedoria e liderar com propósito.
      </p>

      <form id="leadForm" class="form">

        <input name="name" placeholder="Nome" required />
        <input name="email" type="email" placeholder="E-mail" required />
        <input name="whatsapp" placeholder="DDD+WhatsApp" required />

        <button type="submit">
          QUERO GARANTIR MINHA VAGA
        </button>

      </form>

      <span id="msg"></span>

    </div>
  </section>

  <footer>
    CONEXÃO&DESIGN • Todos os direitos reservados
  </footer>

  <!-- SCRIPT PRINCIPAL -->
  <script>
    // Scroll mobile
    document.querySelector(".scroll-btn")
      ?.addEventListener("click", () => {
        document.querySelector(".form-section")
          .scrollIntoView({ behavior: "smooth" });
      });

    // FORM + STRIPE
    const form = document.getElementById("leadForm");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const btn = form.querySelector("button");
      btn.innerText = "Processando...";
      btn.disabled = true;

      const data = {
        name: form.name.value,
        email: form.email.value,
        whatsapp: form.whatsapp.value
      };

      try {

        // 1️⃣ Salva lead no Google Sheets
        await fetch("https://script.google.com/macros/s/AKfycbyfcCdFthcKv2O5gE9c3LwjyBDOZsrfDMJwzETXx5ETrSeOjbVuU4uGVaaXBEM8PztopA/exec", {
          method: "POST",
          body: JSON.stringify(data)
        });

        // 2️⃣ Cria sessão Stripe
        const response = await fetch("/api/create-checkout", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        const checkout = await response.json();

        if (checkout.url) {
          window.location.href = checkout.url;
        } else {
          alert("Erro ao criar checkout.");
          btn.disabled = false;
          btn.innerText = "QUERO GARANTIR MINHA VAGA";
        }

      } catch (error) {
        alert("Erro ao processar.");
        btn.disabled = false;
        btn.innerText = "QUERO GARANTIR MINHA VAGA";
      }

    });
  </script>

</body>
</html>